<?php
return unserialize("a:5:{i:0;a:1:{i:0;a:1:{i:0;a:5:{i:0;s:33:\"tcpfunc_5f18071176da96.08017922_1\";i:1;a:0:{}i:2;i:1;i:3;s:0:\"\";i:4;s:0:\"\";}}}i:1;a:1:{i:0;a:4:{i:0;a:0:{}i:1;i:4;i:2;s:7:\"INCLUDE\";i:3;a:3:{i:0;s:22:\"ATTACHMENT_UI_DEFAULTS\";i:1;s:3:\".js\";i:2;s:10:\"javascript\";}}}i:2;s:7:\"posting\";i:3;N;i:4;a:1:{s:33:\"tcpfunc_5f18071176da96.08017922_1\";s:40594:\"\$tpl_funcs['tcpfunc_5f18071176da96.08017922_1']=\$KEEP_TPL_FUNCS['tcpfunc_5f18071176da96.08017922_1']=recall_named_function('5f18071176e2c9.40714020','\$parameters,\$cl',\"echo \\\"\\\\\\\"use strict\\\\\\\";\\\\n\\\\n/* Form editing code (mostly stuff only used on posting forms) */\\\\n\\\\nrequire_javascript('ajax',window.do_ajax_request);\\\\n\\\\n// ===========\\\\n// ATTACHMENTS\\\\n// ===========\\\\n\\\\nfunction add_attachment(start_num,posting_field_name)\\\\n{\\\\n	if (typeof window.num_attachments=='undefined') return;\\\\n	if (typeof window.max_attachments=='undefined') return;\\\\n\\\\n	var add_to=document.getElementById('attachment_store');\\\\n\\\\n	window.num_attachments++;\\\\n\\\\n	// Add new file input, if we are using naked file inputs\\\\n	if (window.attachment_template.replace(/\\\\\\\\s/,'')!='')\\\\n	{\\\\n		var new_div=document.createElement('div');\\\\n		set_inner_html(new_div,window.attachment_template.replace(/\\\\\\\\_\\\\\\\\_num_attachments\\\\\\\\_\\\\\\\\_/g,window.num_attachments));\\\\n		add_to.appendChild(new_div);\\\\n	}\\\\n\\\\n	// Rebuild uploader button, if we have a singular button\\\\n	if (typeof window.rebuild_attachment_button_for_next!='undefined')\\\\n	{\\\\n		rebuild_attachment_button_for_next(posting_field_name);\\\\n	}\\\\n\\\\n	// Previous file input cannot be used anymore, if it exists\\\\n	var element=document.getElementById('file'+window.num_attachments);\\\\n	if (element) element.setAttribute('unselectable','on');\\\\n\\\\n	if (typeof window.trigger_resize!='undefined') trigger_resize();\\\\n}\\\\n\\\\nfunction attachment_present(post_value,number)\\\\n{\\\\n	return !(post_value.indexOf('[attachment]new_'+number+'[/attachment]')==-1) && (post_value.indexOf('[attachment_safe]new_'+number+'[/attachment_safe]')==-1) && (post_value.indexOf('[attachment thumb=\\\\\\\"1\\\\\\\"]new_'+number+'[/attachment]')==-1) && (post_value.indexOf('[attachment_safe thumb=\\\\\\\"1\\\\\\\"]new_'+number+'[/attachment_safe]')==-1) && (post_value.indexOf('[attachment thumb=\\\\\\\"0\\\\\\\"]new_'+number+'[/attachment]')==-1) && (post_value.indexOf('[attachment_safe thumb=\\\\\\\"0\\\\\\\"]new_'+number+'[/attachment_safe]')==-1);\\\\n}\\\\n\\\\nfunction set_attachment(field_name,number,filename,multi,uploader_settings)\\\\n{\\\\n	if (typeof multi=='undefined') multi=false;\\\\n\\\\n	if (typeof window.insert_textbox=='undefined') return;\\\\n	if (typeof window.num_attachments=='undefined') return;\\\\n	if (typeof window.max_attachments=='undefined') return;\\\\n\\\\n	var post=document.getElementById(field_name);\\\\n	post=ensure_true_id(post,field_name);\\\\n\\\\n	var tmp_form=post.form;\\\\n	if ((tmp_form) && (tmp_form.preview))\\\\n	{\\\\n		tmp_form.preview.checked=false;\\\\n		tmp_form.preview.disabled=true;\\\\n	}\\\\n\\\\n	var post_value=get_textbox(post);\\\\n	var done=attachment_present(post.value,number) || attachment_present(post_value,number);\\\\n	if (!done)\\\\n	{\\\\n		var filepath=filename;\\\\n		if ((!filename) && (document.getElementById('file'+number)))\\\\n		{\\\\n			filepath=document.getElementById('file'+number).value;\\\\n		}\\\\n\\\\n		if (filepath=='')\\\\n			return; // Upload error\\\\n\\\\n		var ext=filepath.replace(/^.*\\\\\\\\./,'').toLowerCase();\\\\n\\\\n		var is_image=(',jpg,jpeg,gif,png,ico,'.indexOf(','+ext+',')!=-1);\\\\n		var is_video=(',3gp,3g2,3gp2,3gpp,3p,asf,avi,flv,f4v,mov,mpa,mp4,mpe,mpeg,mpg,m2v,mpv2,mp2,m4v,qt,ram,rm,wmv,ogg,ogv,webm,pdf,'.indexOf(','+ext+',')!=-1);\\\\n		var is_audio=(',ra,mid,mp3,wav,wma,aif,aifc,aiff,'.indexOf(','+ext+',')!=-1);\\\\n		var is_archive=(ext=='tar') || (ext=='zip');\\\\n\\\\n		var prefix='',suffix='';\\\\n		if (multi && is_image)\\\\n		{\\\\n			prefix='[media_set]\\\\\\\\n';\\\\n			suffix='[/media_set]';\\\\n		}\\\\n\\\\n		var tag='attachment';\\\\n\\\\n		var show_overlay,defaults={};\\\\n		if (filepath.indexOf('fakepath')==-1) // iPhone gives c:\\\\\\\\fakepath\\\\\\\\image.jpg, so don't use that\\\\n			defaults.description=filepath; // Default caption to local file path\\\\n		\\\",\\n	ecv(\\\$cl,array(),4,\\\"INCLUDE\\\",array(\\\"ATTACHMENT_UI_DEFAULTS\\\",\\\".js\\\",\\\"javascript\\\",\\\"\\\",'vars'=>\\\$parameters)),\\n	\\\"\\\\n\\\\n		if (!show_overlay)\\\\n		{\\\\n			var comcode='['+tag;\\\\n			for (var key in defaults)\\\\n			{\\\\n				comcode+=' '+key+'=\\\\\\\"'+(defaults[key].replace(/\\\\\\\"/g,'\\\\\\\\\\\\\\\\\\\\\\\"'))+'\\\\\\\"';\\\\n			}\\\\n			comcode+=']new_'+number+'[/'+tag+']';\\\\n			if (prefix!='') insert_textbox(post,prefix);\\\\n			if (multi)\\\\n			{\\\\n				var split_filename=document.getElementById('txtFileName_file'+window.num_attachments).value.split(/:/);\\\\n				for (var i=0;i<split_filename.length;i++)\\\\n				{\\\\n					if (i!=0) window.num_attachments++;\\\\n\\\\n					var new_comcode=comcode.replace(']new_'+number+'[',']new_'+window.num_attachments+'[');\\\\n					if (split_filename[i].indexOf('fakepath')==-1)\\\\n					{\\\\n						new_comcode=new_comcode.replace(' description=\\\\\\\"'+defaults.description.replace(/\\\\\\\"/g,'\\\\\\\\\\\\\\\\\\\\\\\"')+'\\\\\\\"',' description=\\\\\\\"'+split_filename[i].replace(/\\\\\\\"/g,'\\\\\\\\\\\\\\\\\\\\\\\"')+'\\\\\\\"');\\\\n					}\\\\n\\\\n					insert_textbox(\\\\n						post,\\\\n						new_comcode\\\\n					);\\\\n				}\\\\n				number=''+(window.parseInt(number)+split_filename.length-1);\\\\n			} else\\\\n			{\\\\n				insert_textbox(\\\\n					post,\\\\n					comcode,\\\\n					document.selection?document.selection:null\\\\n				);\\\\n			}\\\\n			if (suffix!='') insert_textbox(post,suffix);\\\\n\\\\n			// Add field for next one\\\\n			var add_another_field=(number==window.num_attachments) && (window.num_attachments<window.max_attachments); // Needs running late, in case something happened inbetween\\\\n			if (add_another_field)\\\\n			{\\\\n				add_attachment(window.num_attachments+1,field_name);\\\\n			}\\\\n\\\\n			if (typeof uploader_settings!='undefined')\\\\n			{\\\\n				uploader_settings.callbacks.push(function() {\\\\n					// Do insta-preview\\\\n					if (is_wysiwyg_field(post))\\\\n					{\\\\n						generate_background_preview(post);\\\\n					}\\\\n				});\\\\n			}\\\\n\\\\n			return;\\\\n		}\\\\n\\\\n		var wysiwyg=is_wysiwyg_field(post);\\\\n\\\\n		if ((typeof window.event!='undefined') && (window.event)) window.event.returnValue=false;\\\\n		var url='\\\",\\n	ecv_FIND_SCRIPT(\\\$cl,array(2),array(\\\"comcode_helper\\\")),\\n	\\\"';\\\\n		url+='?field_name='+field_name;\\\\n		url+='&type=step2';\\\\n		url+='&tag='+tag;\\\\n		url+='&default=new_'+number;\\\\n		url+='&is_image='+(is_image?'1':'0');\\\\n		url+='&is_archive='+(is_archive?'1':'0');\\\\n		url+='&multi='+(multi?'1':'0');\\\\n		url+='&prefix='+prefix;\\\\n		if (wysiwyg) url+='&in_wysiwyg=1';\\\\n		for (var key in defaults)\\\\n		{\\\\n			url+='&default_'+key+'='+window.encodeURIComponent(defaults[key]);\\\\n		}\\\\n		url+=keep_stub();\\\\n\\\\n		window.setTimeout(function() {\\\\n			window.faux_showModalDialog(\\\\n				maintain_theme_in_link(url),\\\\n				'',\\\\n				'width=750,height=auto,status=no,resizable=yes,scrollbars=yes,unadorned=yes',\\\\n				function(comcode_added)\\\\n				{\\\\n					if (comcode_added)\\\\n					{\\\\n						// Add in additional Comcode buttons for the other files selected at the same time\\\\n						if (multi)\\\\n						{\\\\n							var comcode_semihtml='',comcode='';\\\\n							var split_filename=document.getElementById('txtFileName_file'+window.num_attachments).value.split(/:/);\\\\n							for (var i=1;i<split_filename.length;i++)\\\\n							{\\\\n								window.num_attachments++;\\\\n								var tmp=window.insert_comcode_tag(\\\\n									[']new_'+number+'[',' description=\\\\\\\"'+defaults.description.replace(/\\\\\\\"/g,'\\\\\\\\\\\\\\\\\\\\\\\"')+'\\\\\\\"'],\\\\n									[']new_'+window.num_attachments+'[',' description=\\\\\\\"'+((filepath.indexOf('fakepath')==-1)?filepath:defaults.description).replace(/\\\\\\\"/g,'\\\\\\\\\\\\\\\\\\\\\\\"')+'\\\\\\\"'],\\\\n									true\\\\n								);\\\\n								comcode_semihtml+=tmp[0];\\\\n								comcode+=tmp[1];\\\\n							}\\\\n							number=''+(window.parseInt(number)+split_filename.length-1);\\\\n\\\\n							if (suffix!='')\\\\n							{\\\\n								comcode+=suffix;\\\\n								comcode_semihtml+=suffix;\\\\n							}\\\\n\\\\n							insert_textbox(post,comcode,null,true,comcode_semihtml);\\\\n						}\\\\n\\\\n						// Add field for next one\\\\n						var add_another_field=(number==window.num_attachments) && (window.num_attachments<window.max_attachments); // Needs running late, in case something happened inbetween\\\\n						if (add_another_field)\\\\n						{\\\\n							add_attachment(window.num_attachments+1,field_name);\\\\n						}\\\\n\\\\n						// Do insta-preview\\\\n						if ((comcode_added.indexOf('[attachment_safe')!=-1) && (is_wysiwyg_field(post)))\\\\n						{\\\\n							generate_background_preview(post);\\\\n						}\\\\n					} else // Cancelled\\\\n					{\\\\n						var clear_button=document.getElementById('fsClear_file'+number);\\\\n						if (clear_button)\\\\n						{\\\\n							clear_button.onclick();\\\\n						}\\\\n					}\\\\n				}\\\\n			);\\\\n		},800); // In a timeout to disassociate possible 'enter' keypress which could have led to this function being called [enter on the file selection dialogue] and could propagate through (on Google Chrome anyways, maybe a browser bug)\\\\n	} else\\\\n	{\\\\n		// Add field for next one\\\\n		var add_another_field=(number==window.num_attachments) && (window.num_attachments<window.max_attachments);\\\\n		if (add_another_field)\\\\n			add_attachment(window.num_attachments+1,field_name);\\\\n	}\\\\n}\\\\n\\\\nfunction generate_background_preview(post)\\\\n{\\\\n	var form_post='';\\\\n	var form=post.form;\\\\n	for (var i=0;i<form.elements.length;i++)\\\\n	{\\\\n		if ((!form.elements[i].disabled) && (typeof form.elements[i].name!='undefined') && (form.elements[i].name!=''))\\\\n		{\\\\n			var name=form.elements[i].name;\\\\n			var value=clever_find_value(form,form.elements[i]);\\\\n			if (name=='title' && value=='') value='x'; // Fudge, title must be filled in on many forms\\\\n			form_post+='&'+name+'='+window.encodeURIComponent(value);\\\\n		}\\\\n	}\\\\n	form_post=modsecurity_workaround_ajax(form_post.substr(1));\\\\n	var preview_ret=do_ajax_request(window.form_preview_url+'&js_only=1&known_utf8=1',null,form_post);\\\\n	var _eval_text=preview_ret.responseText;\\\\n	var eval_text=_eval_text.replace(/.*<script[^<>]*>/i,'').replace(/<\\\\\\\\/script>.*/i,'');\\\\n	if (_eval_text!=eval_text) eval(eval_text);\\\\n}\\\\n\\\\n// ====================\\\\n// COMCODE UI FUNCTIONS\\\\n// ====================\\\\n\\\\nfunction do_input_html(field_name)\\\\n{\\\\n	if (typeof window.insert_textbox_wrapping=='undefined') return;\\\\n\\\\n	var post=document.getElementById(field_name);\\\\n	post=ensure_true_id(post,field_name);\\\\n	insert_textbox_wrapping(post,'semihtml','');\\\\n}\\\\n\\\\nfunction do_input_code(field_name)\\\\n{\\\\n	if (typeof window.insert_textbox_wrapping=='undefined') return;\\\\n\\\\n	var post=document.getElementById(field_name);\\\\n	post=ensure_true_id(post,field_name);\\\\n	insert_textbox_wrapping(post,(post.name=='message')?'tt':'codebox','');\\\\n}\\\\n\\\\nfunction do_input_quote(field_name)\\\\n{\\\\n	if (typeof window.insert_textbox_wrapping=='undefined') return;\\\\n\\\\n	var post=document.getElementById(field_name);\\\\n	post=ensure_true_id(post,field_name);\\\\n	window.fauxmodal_prompt(\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_QUOTE_BY\\\",array()),\\n	\\\"',\\\\n		'',\\\\n		function(va)\\\\n		{\\\\n			if (va!==null) insert_textbox_wrapping(post,'[quote=\\\\\\\\\\\\\\\"'+va+'\\\\\\\\\\\\\\\"]','[/quote]');\\\\n		},\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_quote\\\",array()),\\n	\\\"'\\\\n	);\\\\n}\\\\n\\\\nfunction do_input_box(field_name)\\\\n{\\\\n	if (typeof window.insert_textbox_wrapping=='undefined') return;\\\\n\\\\n	var post=document.getElementById(field_name);\\\\n	post=ensure_true_id(post,field_name);\\\\n	window.fauxmodal_prompt(\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_BOX_TITLE\\\",array()),\\n	\\\"',\\\\n		'',\\\\n		function(va)\\\\n		{\\\\n			if (va!==null) insert_textbox_wrapping(post,'[box=\\\\\\\\\\\\\\\"'+va+'\\\\\\\\\\\\\\\"]','[/box]');\\\\n		},\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_box\\\",array()),\\n	\\\"'\\\\n	);\\\\n}\\\\n\\\\nfunction do_input_menu(field_name)\\\\n{\\\\n	if (typeof window.insert_textbox=='undefined') return;\\\\n\\\\n	window.fauxmodal_prompt(\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_MENU_NAME\\\",array(\\\"'+(document.getElementById(field_name).form.menu_items.value)+'\\\")),\\n	\\\"',\\\\n		'',\\\\n		function(va)\\\\n		{\\\\n			if (va)\\\\n			{\\\\n				window.fauxmodal_prompt(\\\\n					'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_MENU_CAPTION\\\",array()),\\n	\\\"',\\\\n					'',\\\\n					function(vb)\\\\n					{\\\\n						if (!vb) vb='';\\\\n\\\\n						var add;\\\\n						var element=document.getElementById(field_name);\\\\n						element=ensure_true_id(element,field_name);\\\\n						add='[block=\\\\\\\\\\\\\\\"\\\\\\\"+escape_comcode(va)+\\\\\\\"\\\\\\\\\\\\\\\" caption=\\\\\\\\\\\\\\\"\\\\\\\"+escape_comcode(vb)+\\\\\\\"\\\\\\\\\\\\\\\" type=\\\\\\\\\\\\\\\"tree\\\\\\\\\\\\\\\"]menu[/block]';\\\\n						insert_textbox(element,add);\\\\n					},\\\\n					'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_menu\\\",array()),\\n	\\\"'\\\\n				);\\\\n			}\\\\n		},\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_menu\\\",array()),\\n	\\\"'\\\\n	);\\\\n}\\\\n\\\\nfunction do_input_block(field_name)\\\\n{\\\\n	if ((typeof window.event!='undefined') && (window.event)) window.event.returnValue=false;\\\\n	var url='\\\",\\n	ecv_FIND_SCRIPT(\\\$cl,array(2),array(\\\"block_helper\\\")),\\n	\\\"?field_name='+field_name+keep_stub();\\\\n	url=url+'&block_type='+(((field_name.indexOf('edit_panel_')==-1) && (window.location.href.indexOf(':panel_')==-1))?'main':'side');\\\\n	window.faux_open(maintain_theme_in_link(url),'','width=750,height=auto,status=no,resizable=yes,scrollbars=yes',null,'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_CANCEL\\\",array()),\\n	\\\"');\\\\n}\\\\n\\\\nfunction do_input_comcode(field_name,tag)\\\\n{\\\\n	var attributes={};\\\\n	var default_embed=null;\\\\n	var save_to_id=null;\\\\n\\\\n	if (tag==null)\\\\n	{\\\\n		var element=document.getElementById(field_name);\\\\n		if (is_wysiwyg_field(element))\\\\n		{\\\\n			var selection=window.wysiwyg_editors[field_name].getSelection();\\\\n			var ranges=selection.getRanges();\\\\n			if (typeof ranges[0]!='undefined')\\\\n			{\\\\n				var comcode_element=ranges[0].startContainer.\\\\\\\$;\\\\n				do\\\\n				{\\\\n					var matches=comcode_element.nodeName.toLowerCase().match(/^comcode-(\\\\\\\\w+)/);\\\\n					if (matches!==null)\\\\n					{\\\\n						tag=matches[1];\\\\n\\\\n						for (var i=0;i<comcode_element.attributes.length;i++)\\\\n						{\\\\n							if (comcode_element.attributes[i].name!='id')\\\\n							{\\\\n								attributes[comcode_element.attributes[i].name]=comcode_element.attributes[i].value;\\\\n							}\\\\n						}\\\\n\\\\n						default_embed=get_inner_html(comcode_element);\\\\n\\\\n						if (comcode_element.id=='')\\\\n						{\\\\n							comcode_element.id='comcode_'+Date.now();\\\\n						}\\\\n						save_to_id=comcode_element.id;\\\\n\\\\n						break;\\\\n					}\\\\n\\\\n					comcode_element=comcode_element.parentNode;\\\\n				}\\\\n				while (comcode_element!==null);\\\\n			}\\\\n		}\\\\n	}\\\\n\\\\n	if ((typeof window.event!='undefined') && (window.event)) window.event.returnValue=false;\\\\n\\\\n	var url='\\\",\\n	ecv_FIND_SCRIPT(\\\$cl,array(2),array(\\\"comcode_helper\\\")),\\n	\\\"?field_name='+window.encodeURIComponent(field_name);\\\\n	if (tag)\\\\n	{\\\\n		url+='&tag='+window.encodeURIComponent(tag);\\\\n	}\\\\n	if (default_embed!==null)\\\\n	{\\\\n		url+='&type=replace';\\\\n	} else\\\\n	{\\\\n		if (tag==null)\\\\n		{\\\\n			url+='&type=step1';\\\\n		} else {\\\\n			url+='&type=step2';\\\\n		}\\\\n	}\\\\n	if (is_wysiwyg_field(document.getElementById(field_name))) url+='&in_wysiwyg=1';\\\\n	for (var key in attributes)\\\\n	{\\\\n		url+='&default_'+key+'='+window.encodeURIComponent(attributes[key]);\\\\n	}\\\\n	if (default_embed!==null)\\\\n	{\\\\n		url+='&default='+window.encodeURIComponent(default_embed);\\\\n	}\\\\n	if (save_to_id!==null)\\\\n	{\\\\n		url+='&save_to_id='+window.encodeURIComponent(save_to_id);\\\\n	}\\\\n	url+=keep_stub();\\\\n\\\\n	window.faux_open(maintain_theme_in_link(url),'','width=750,height=auto,status=no,resizable=yes,scrollbars=yes',null,'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_CANCEL\\\",array()),\\n	\\\"');\\\\n}\\\\n\\\\nfunction do_input_list(field_name,add)\\\\n{\\\\n	if (typeof window.insert_textbox=='undefined') return;\\\\n\\\\n	if (typeof add=='undefined') add=[];\\\\n\\\\n	var post=document.getElementById(field_name);\\\\n	post=ensure_true_id(post,field_name);\\\\n	insert_textbox(post,'\\\\\\\\n');\\\\n	window.fauxmodal_prompt(\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_LIST_ENTRY\\\",array()),\\n	\\\"',\\\\n		'',\\\\n		function(va)\\\\n		{\\\\n			if ((va!=null) && (va!=''))\\\\n			{\\\\n				add.push(va);\\\\n				return do_input_list(field_name,add)\\\\n			}\\\\n			if (add.length==0) return;\\\\n			var i;\\\\n			if (post.value.indexOf('[semihtml')!=-1)\\\\n				insert_textbox(post,'[list]\\\\\\\\n');\\\\n			for (i=0;i<add.length;i++)\\\\n			{\\\\n				if (post.value.indexOf('[semihtml')!=-1)\\\\n				{\\\\n					insert_textbox(post,'[*]'+add[i]+'\\\\\\\\n')\\\\n				} else\\\\n				{\\\\n					insert_textbox(post,' - '+add[i]+'\\\\\\\\n')\\\\n				}\\\\n			}\\\\n			if (post.value.indexOf('[semihtml')!=-1)\\\\n				insert_textbox(post,'[/list]\\\\\\\\n')\\\\n		},\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_list\\\",array()),\\n	\\\"'\\\\n	);\\\\n}\\\\n\\\\nfunction do_input_hide(field_name)\\\\n{\\\\n	if (typeof window.insert_textbox=='undefined') return;\\\\n\\\\n	window.fauxmodal_prompt(\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_WARNING\\\",array()),\\n	\\\"',\\\\n		'',\\\\n		function(va)\\\\n		{\\\\n			if (va)\\\\n			{\\\\n				window.fauxmodal_prompt(\\\\n					'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_HIDDEN_TEXT\\\",array()),\\n	\\\"',\\\\n					'',\\\\n					function(vb)\\\\n					{\\\\n						var element=document.getElementById(field_name);\\\\n						element=ensure_true_id(element,field_name);\\\\n						if (vb)\\\\n						{\\\\n							insert_textbox(element,'[hide=\\\\\\\\\\\\\\\"'+escape_comcode(va)+'\\\\\\\\\\\\\\\"]'+escape_comcode(vb)+'[/hide]');\\\\n						}\\\\n					},\\\\n					'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_hide\\\",array()),\\n	\\\"'\\\\n				);\\\\n			}\\\\n		},\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_hide\\\",array()),\\n	\\\"'\\\\n	);\\\\n}\\\\n\\\\nfunction do_input_thumb(field_name,va)\\\\n{\\\\n	if (typeof window.insert_textbox=='undefined') return;\\\\n\\\\n	if (typeof window.start_simplified_upload!='undefined' && document.getElementById(field_name).name!='message')\\\\n	{\\\\n		var test=start_simplified_upload(field_name);\\\\n		if (test) return;\\\\n	}\\\\n\\\\n	window.fauxmodal_prompt(\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_URL\\\",array()),\\n	\\\"',\\\\n		va,\\\\n		function(va)\\\\n		{\\\\n			if ((va!=null) && (va.indexOf('://')==-1))\\\\n			{\\\\n				window.fauxmodal_alert('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:NOT_A_URL\\\",array()),\\n	\\\"',function() {\\\\n					do_input_url(field_name,va);\\\\n				});\\\\n				return;\\\\n			}\\\\n\\\\n			if (va)\\\\n			{\\\\n				generate_question_ui(\\\\n					'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:THUMB_OR_IMG_2\\\",array()),\\n	\\\"',\\\\n					{buttons__thumbnail: '\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"THUMBNAIL\\\",array()),\\n	\\\"',buttons__fullsize: '\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"IMAGE\\\",array()),\\n	\\\"'},\\\\n					'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_img\\\",array()),\\n	\\\"',\\\\n					null,\\\\n					function(vb)\\\\n					{\\\\n						window.fauxmodal_prompt(\\\\n							'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_IMAGE_CAPTION\\\",array()),\\n	\\\"',\\\\n							'',\\\\n							function(vc)\\\\n							{\\\\n								if (!vc) vc='';\\\\n\\\\n								var element=document.getElementById(field_name);\\\\n								element=ensure_true_id(element,field_name);\\\\n								if (vb.toLowerCase()=='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"IMAGE\\\",array()),\\n	\\\"'.toLowerCase())\\\\n								{\\\\n									insert_textbox(element,'[img=\\\\\\\\\\\\\\\"'+escape_comcode(vc)+'\\\\\\\\\\\\\\\"]'+escape_comcode(va)+'[/img]');\\\\n								} else\\\\n								{\\\\n									insert_textbox(element,'[thumb caption=\\\\\\\\\\\\\\\"'+escape_comcode(vc)+'\\\\\\\\\\\\\\\"]'+escape_comcode(va)+'[/thumb]');\\\\n								}\\\\n							},\\\\n							'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_img\\\",array()),\\n	\\\"'\\\\n						);\\\\n					}\\\\n				);\\\\n			}\\\\n		},\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_img\\\",array()),\\n	\\\"'\\\\n	);\\\\n}\\\\n\\\\nfunction do_input_attachment(field_name)\\\\n{\\\\n	if (typeof window.insert_textbox=='undefined') return;\\\\n\\\\n	window.fauxmodal_prompt(\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_ATTACHMENT\\\",array()),\\n	\\\"',\\\\n		'',\\\\n		function(va)\\\\n		{\\\\n			if (!is_integer(va))\\\\n			{\\\\n				window.fauxmodal_alert('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:NOT_VALID_ATTACHMENT\\\",array()),\\n	\\\"');\\\\n			} else\\\\n			{\\\\n				var element=document.getElementById(field_name);\\\\n				element=ensure_true_id(element,field_name);\\\\n				insert_textbox(element,'[attachment]new_'+va+'[/attachment]');\\\\n			}\\\\n		},\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_attachment\\\",array()),\\n	\\\"'\\\\n	);\\\\n}\\\\n\\\\nfunction do_input_url(field_name,va)\\\\n{\\\\n	if (typeof window.insert_textbox=='undefined') return;\\\\n\\\\n	window.fauxmodal_prompt(\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_URL\\\",array()),\\n	\\\"',\\\\n		va,\\\\n		function(va)\\\\n		{\\\\n			if ((va!=null) && (va.indexOf('://')==-1))\\\\n			{\\\\n				window.fauxmodal_alert('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:NOT_A_URL\\\",array()),\\n	\\\"',function() {\\\\n					do_input_url(field_name,va);\\\\n				});\\\\n				return;\\\\n			}\\\\n\\\\n			if (va!==null)\\\\n			{\\\\n				window.fauxmodal_prompt(\\\\n					'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_LINK_NAME\\\",array()),\\n	\\\"',\\\\n					'',\\\\n					function(vb)\\\\n					{\\\\n						var element=document.getElementById(field_name);\\\\n						element=ensure_true_id(element,field_name);\\\\n						if (vb!=null) insert_textbox(element,'[url=\\\\\\\\\\\\\\\"'+escape_comcode(vb)+'\\\\\\\\\\\\\\\"]'+escape_comcode(va)+'[/url]');\\\\n					},\\\\n					'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_url\\\",array()),\\n	\\\"'\\\\n				);\\\\n			}\\\\n		},\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_url\\\",array()),\\n	\\\"'\\\\n	);\\\\n}\\\\n\\\\nfunction do_input_page(field_name)\\\\n{\\\\n	if (typeof window.insert_textbox=='undefined') return;\\\\n\\\\n	var result;\\\\n\\\\n	if (typeof window.showModalDialog!='undefined'\\\",\\n	(\\\" || true\\\"),\\n	\\\")\\\\n	{\\\\n		window.faux_showModalDialog(\\\\n			maintain_theme_in_link('\\\",\\n	ecv_FIND_SCRIPT(\\\$cl,array(2),array(\\\"page_link_chooser\\\")),\\n	\\\"'+keep_stub(true)),\\\\n			null,\\\\n			'dialogWidth=600;dialogHeight=400;status=no;unadorned=yes',\\\\n			function(result)\\\\n			{\\\\n				if ((typeof result=='undefined') || (result===null)) return;\\\\n\\\\n				window.fauxmodal_prompt(\\\\n					'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_CAPTION\\\",array()),\\n	\\\"',\\\\n					'',\\\\n					function(vc)\\\\n					{\\\\n						_do_input_page(field_name,result,vc);\\\\n					},\\\\n					'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_page\\\",array()),\\n	\\\"'\\\\n				);\\\\n			}\\\\n		);\\\\n	} else\\\\n	{\\\\n		window.fauxmodal_prompt(\\\\n			'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_ZONE\\\",array()),\\n	\\\"',\\\\n			'',\\\\n			function(va)\\\\n			{\\\\n				if (va!==null)\\\\n				{\\\\n					window.fauxmodal_prompt(\\\\n						'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_PAGE\\\",array()),\\n	\\\"',\\\\n						'',\\\\n						function(vb)\\\\n						{\\\\n							if (vb!==null)\\\\n							{\\\\n								result=va+':'+vb;\\\\n\\\\n								window.fauxmodal_prompt(\\\\n									'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_CAPTION\\\",array()),\\n	\\\"',\\\\n									'',\\\\n									function(vc)\\\\n									{\\\\n										_do_input_page(field_name,result,vc);\\\\n									},\\\\n									'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_page\\\",array()),\\n	\\\"'\\\\n								);\\\\n							}\\\\n						}\\\\n					);\\\\n				}\\\\n			},\\\\n			'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_page\\\",array()),\\n	\\\"'\\\\n		);\\\\n	}\\\\n}\\\\n\\\\nfunction _do_input_page(field_name,result,vc)\\\\n{\\\\n	var element=document.getElementById(field_name);\\\\n	element=ensure_true_id(element,field_name);\\\\n	insert_textbox(element,'[page=\\\\\\\\\\\\\\\"'+escape_comcode(result)+'\\\\\\\\\\\\\\\"]'+escape_comcode(vc)+'[/page]');\\\\n}\\\\n\\\\nfunction do_input_email(field_name,va)\\\\n{\\\\n	if (typeof window.insert_textbox=='undefined') return;\\\\n\\\\n	window.fauxmodal_prompt(\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_ADDRESS\\\",array()),\\n	\\\"',\\\\n		va,\\\\n		function(va)\\\\n		{\\\\n			if ((va!=null) && (va.indexOf('@')==-1))\\\\n			{\\\\n				window.fauxmodal_alert('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:NOT_A_EMAIL\\\",array()),\\n	\\\"',function() {\\\\n					do_input_url(field_name,va);\\\\n				});\\\\n				return;\\\\n			}\\\\n\\\\n			if (va!==null)\\\\n			{\\\\n				window.fauxmodal_prompt(\\\\n					'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:ENTER_CAPTION\\\",array()),\\n	\\\"',\\\\n					'',\\\\n					function(vb)\\\\n					{\\\\n						var element=document.getElementById(field_name);\\\\n						element=ensure_true_id(element,field_name);\\\\n						if (vb!==null) insert_textbox(element,'[email=\\\\\\\\\\\\\\\"'+escape_comcode(vb)+'\\\\\\\\\\\\\\\"]'+escape_comcode(va)+'[/email]');\\\\n					},\\\\n					'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_email\\\",array()),\\n	\\\"'\\\\n				);\\\\n			}\\\\n		},\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"comcode:INPUT_COMCODE_email\\\",array()),\\n	\\\"'\\\\n	);\\\\n}\\\\n\\\\nfunction do_input_b(field_name)\\\\n{\\\\n	if (typeof window.insert_textbox_wrapping=='undefined') return;\\\\n\\\\n	var element=document.getElementById(field_name);\\\\n	element=ensure_true_id(element,field_name);\\\\n	insert_textbox_wrapping(element,'b','');\\\\n}\\\\n\\\\nfunction do_input_i(field_name)\\\\n{\\\\n	if (typeof window.insert_textbox_wrapping=='undefined') return;\\\\n\\\\n	var element=document.getElementById(field_name);\\\\n	element=ensure_true_id(element,field_name);\\\\n	insert_textbox_wrapping(element,'i','');\\\\n}\\\\n\\\\nfunction do_input_font(field_name)\\\\n{\\\\n	if (typeof window.insert_textbox_wrapping=='undefined') return;\\\\n\\\\n	var element=document.getElementById(field_name);\\\\n	element=ensure_true_id(element,field_name);\\\\n	var form=element.form;\\\\n	var face=form.elements['f_face'];\\\\n	var size=form.elements['f_size'];\\\\n	var colour=form.elements['f_colour'];\\\\n	if ((face.value=='') && (size.value=='') && (colour.value==''))\\\\n	{\\\\n		window.fauxmodal_alert('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:NO_FONT_SELECTED\\\",array()),\\n	\\\"');\\\\n		return;\\\\n	}\\\\n	insert_textbox_wrapping(document.getElementById(field_name),'[font=\\\\\\\\\\\\\\\"'+escape_comcode(face.value)+'\\\\\\\\\\\\\\\" color=\\\\\\\\\\\\\\\"'+escape_comcode(colour.value)+'\\\\\\\\\\\\\\\" size=\\\\\\\\\\\\\\\"'+escape_comcode(size.value)+'\\\\\\\\\\\\\\\"]','[/font]');\\\\n}\\\\n\\\\nfunction set_font_sizes(list)\\\\n{\\\\n	var i=0;\\\\n	for (i=1;i<list.options.length;i++)\\\\n	{\\\\n		list.options[i].style.fontSize=list.options[i].value+'em';\\\\n	}\\\\n}\\\\n\\\\nfunction deset_font_sizes(list)\\\\n{\\\\n	var i=0;\\\\n	for (i=1;i<list.options.length;i++)\\\\n	{\\\\n		list.options[i].style.fontSize='';\\\\n	}\\\\n}\\\\n\\\\n// ==================\\\\n// Auto-saving/drafts\\\\n// ==================\\\\n\\\\n/*\\\\nWe support both remote and local saving.\\\\n\\\\nThe advantage of local saving is that it works when you're offline or the server is offline.\\\\nAlso, it is faster because no load/save network requests are required.\\\\n\\\\nThe advantage of remove saving is you can switch machines.\\\\n*/\\\\n\\\\nfunction init_form_saving(form_id)\\\\n{\\\\n	window.last_autosave=new Date();\\\\n\\\\n	\\\",\\n	((ecv_DEV_MODE(\\\$cl,array(),array())==\\\"1\\\")?(\\\"\\\\n		if (typeof console.log!='undefined') console.log('Initialising auto-save subsystem');\\\\n	\\\"):''),\\n	\\\"\\\\n\\\\n	// Go through all forms/elements\\\\n	var form=document.getElementById(form_id);\\\\n	for (var i=0;i<form.elements.length;i++)\\\\n	{\\\\n		if (field_supports_autosave(form.elements[i]))\\\\n		{\\\\n			// Register events for auto-save\\\\n			add_event_listener_abstract(form.elements[i],'keypress',handle_form_saving);\\\\n			add_event_listener_abstract(form.elements[i],'blur',handle_form_saving);\\\\n			form.elements[i].externalOnKeyPress=handle_form_saving;\\\\n		}\\\\n	}\\\\n\\\\n	// Register event for explicit draft save\\\\n	add_event_listener_abstract(document.body,'keydown',function(form) { return function(event) { handle_form_saving_explicit(event,form); } }(form) );\\\\n\\\\n	// Load via local storage\\\\n	var autosave_value=read_cookie(encodeURIComponent(get_autosave_url_stem()));\\\\n	if ((autosave_value!='') && (autosave_value!='0'))\\\\n	{\\\\n		if (typeof window.localStorage!='undefined')\\\\n		{\\\\n			var fields_to_do={},fields_to_do_counter=0,biggest_length_data='';\\\\n			var key,value;\\\\n			var element_name,autosave_name;\\\\n			for (var j=0;j<form.elements.length;j++)\\\\n			{\\\\n				element_name=(typeof form.elements[j].name=='undefined')?form.elements[0][j].name:form.elements[j].name;\\\\n				autosave_name=get_autosave_name(element_name);\\\\n				if (typeof localStorage[autosave_name]!='undefined')\\\\n				{\\\\n					key=autosave_name;\\\\n					value=localStorage[autosave_name];\\\\n\\\\n					fields_to_do[element_name]=value;\\\\n					fields_to_do_counter++;\\\\n					if (value.length>biggest_length_data.length) // The longest is what we quote to the user as being restored\\\\n					{\\\\n						biggest_length_data=value;\\\\n					}\\\\n\\\\n					\\\",\\n	((ecv_DEV_MODE(\\\$cl,array(),array())==\\\"1\\\")?(\\\"\\\\n						if (typeof console.log!='undefined') console.log('+ Has autosave for '+element_name+' ('+autosave_name+')');\\\\n					\\\"):''),\\n	\\\"\\\\n				} else\\\\n				{\\\\n					\\\",\\n	((ecv_DEV_MODE(\\\$cl,array(),array())==\\\"1\\\")?(\\\"\\\\n						//if (typeof console.log!='undefined') console.log('- Has no autosave for '+element_name);\\\\n					\\\"):''),\\n	\\\"\\\\n				}\\\\n			}\\\\n\\\\n			if ((fields_to_do_counter!=0) && (biggest_length_data.length>25))\\\\n			{\\\\n				_restore_form_autosave(form,fields_to_do,biggest_length_data);\\\\n				return; // If we had it locally, we won't let it continue on to try via AJAX\\\\n			} else\\\\n			{\\\\n				\\\",\\n	((ecv_DEV_MODE(\\\$cl,array(),array())==\\\"1\\\")?(\\\"\\\\n					if (typeof console.log!='undefined') console.log('No auto-save, fields found was '+fields_to_do_counter+', largest length was '+biggest_length_data.length);\\\\n				\\\"):''),\\n	\\\"\\\\n			}\\\\n		}\\\\n	} else\\\\n	{\\\\n		\\\",\\n	((ecv_DEV_MODE(\\\$cl,array(),array())==\\\"1\\\")?(\\\"\\\\n			if (typeof console.log!='undefined') console.log('Nothing in local storage');\\\\n		\\\"):''),\\n	\\\"\\\\n	}\\\\n\\\\n	// Load via AJAX (if issue happened on another machine, or if we do not support local storage)\\\\n	if (navigator.onLine)\\\\n	{\\\\n		\\\",\\n	((ecv_DEV_MODE(\\\$cl,array(),array())==\\\"1\\\")?(\\\"\\\\n			if (typeof console.log!='undefined') console.log('Searching AJAX for auto-save');\\\\n		\\\"):''),\\n	\\\"\\\\n\\\\n		var url='\\\",\\n	ecv_FIND_SCRIPT(\\\$cl,array(2),array(\\\"autosave\\\")),\\n	\\\"?type=retrieve';\\\\n		url+='&stem='+window.encodeURIComponent(get_autosave_url_stem());\\\\n		url+=keep_stub();\\\\n		var callback=function(form) { return function(result) {\\\\n			\\\",\\n	((ecv_DEV_MODE(\\\$cl,array(),array())==\\\"1\\\")?(\\\"\\\\n				if (typeof console.log!='undefined') console.log('Auto-save AJAX says',result);\\\\n			\\\"):''),\\n	\\\"\\\\n\\\\n			_retrieve_form_autosave(result,form);\\\\n		} }(form);\\\\n		do_ajax_request(url,callback);\\\\n	}\\\\n}\\\\n\\\\nfunction _retrieve_form_autosave(result,form)\\\\n{\\\\n	var fields_to_do={},fields_to_do_counter=0,biggest_length_data='';\\\\n	var key,value;\\\\n	var fields=result.getElementsByTagName('field');\\\\n	var element,element_name,autosave_name;\\\\n	for (var i=0;i<fields.length;i++)\\\\n	{\\\\n		key=fields[i].getAttribute('key');\\\\n		value=fields[i].getAttribute('value');\\\\n\\\\n		element=null;\\\\n		for (var j=0;j<form.elements.length;j++)\\\\n		{\\\\n			element_name=(typeof form.elements[j].name=='undefined')?form.elements[0][j].name:form.elements[j].name;\\\\n			autosave_name=get_autosave_name(element_name);\\\\n			if (autosave_name==key)\\\\n			{\\\\n				element=form.elements[j];\\\\n				break;\\\\n			}\\\\n		}\\\\n\\\\n		if (element)\\\\n		{\\\\n			fields_to_do[element_name]=value;\\\\n			fields_to_do_counter++;\\\\n			if (value.length>biggest_length_data.length) // The longest is what we quote to the user as being restored\\\\n			{\\\\n				biggest_length_data=value;\\\\n			}\\\\n		}\\\\n	}\\\\n\\\\n	if ((fields_to_do_counter!=0) && (biggest_length_data.length>25))\\\\n	{\\\\n		_restore_form_autosave(form,fields_to_do,biggest_length_data);\\\\n	} else\\\\n	{\\\\n		\\\",\\n	((ecv_DEV_MODE(\\\$cl,array(),array())==\\\"1\\\")?(\\\"\\\\n			if (typeof console.log!='undefined') console.log('No auto-save, fields found was '+fields_to_do_counter+', largest length was '+biggest_length_data.length);\\\\n		\\\"):''),\\n	\\\"\\\\n	}\\\\n}\\\\n\\\\nfunction _restore_form_autosave(form,fields_to_do,biggest_length_data)\\\\n{\\\\n	var autosave_name;\\\\n\\\\n	// If we've found something to restore then invite user to restore it\\\\n	biggest_length_data=biggest_length_data.replace(/<[^>]*>/g,'').replace(/\\\\\\\\n/g,' ').replace(/&nbsp;/g,' '); // Strip HTML and new lines\\\\n	if (biggest_length_data.length>100) biggest_length_data=biggest_length_data.substr(0,100)+'...'; // Trim down if needed\\\\n	window.fauxmodal_confirm(\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:RESTORE_SAVED_FORM_DATA\\\",array()),\\n	\\\"\\\\\\\\n\\\\\\\\n'+biggest_length_data,\\\\n		function(result)\\\\n		{\\\\n			if (result)\\\\n			{\\\\n				for (key in fields_to_do)\\\\n				{\\\\n					if (typeof fields_to_do[key]!='string') continue;\\\\n\\\\n					if (typeof form.elements[key]!='undefined')\\\\n					{\\\\n						if (typeof console.log!='undefined') console.log('Restoring '+key);\\\\n						clever_set_value(form,form.elements[key],fields_to_do[key]);\\\\n					}\\\\n				}\\\\n			} else\\\\n			{\\\\n				// Was asked to throw the autosave away...\\\\n\\\\n				set_cookie(encodeURIComponent(get_autosave_url_stem()),'0',0.167/*4 hours*/); // Mark as not wanting to restore from local storage\\\\n\\\\n				if (typeof window.localStorage!='undefined')\\\\n				{\\\\n					for (var key in fields_to_do)\\\\n					{\\\\n						if (typeof fields_to_do[key]!='string') continue;\\\\n\\\\n						autosave_name=get_autosave_name(key);\\\\n						if (typeof localStorage[autosave_name]!='undefined')\\\\n						{\\\\n							delete localStorage[autosave_name];\\\\n						}\\\\n					}\\\\n				}\\\\n			}\\\\n		},\\\\n		'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:AUTO_SAVING\\\",array()),\\n	\\\"'\\\\n	);\\\\n}\\\\n\\\\nfunction field_supports_autosave(element)\\\\n{\\\\n	if ((typeof element.length!='undefined') && (typeof element.nodeName=='undefined'))\\\\n	{\\\\n		// Radio button\\\\n		element=element[0];\\\\n	}\\\\n\\\\n	if (typeof element.name=='undefined') return false;\\\\n	var name=element.name;\\\\n	if (name=='') return false;\\\\n	if (name.substr(-2)=='[]') return false;\\\\n\\\\n	if (is_wysiwyg_field(element)) return true;\\\\n\\\\n	if (element.disabled) return false;\\\\n\\\\n	switch (element.nodeName.toLowerCase())\\\\n	{\\\\n		case 'textarea':\\\\n		case 'select':\\\\n			return true;\\\\n		case 'input':\\\\n			switch (element.type)\\\\n			{\\\\n				case 'checkbox':\\\\n				case 'radio':\\\\n				case 'text':\\\\n				case 'color':\\\\n				case 'date':\\\\n				case 'datetime':\\\\n				case 'datetime-local':\\\\n				case 'email':\\\\n				case 'month':\\\\n				case 'number':\\\\n				case 'range':\\\\n				case 'tel':\\\\n				case 'time':\\\\n				case 'url':\\\\n				case 'week':\\\\n					return true;\\\\n			}\\\\n	}\\\\n\\\\n	return false;\\\\n}\\\\n\\\\nfunction is_typed_input(element)\\\\n{\\\\n	if ((typeof element.length!='undefined') && (typeof element.nodeName=='undefined'))\\\\n	{\\\\n		// Radio button\\\\n		element=element[0];\\\\n	}\\\\n\\\\n	switch (element.nodeName.toLowerCase())\\\\n	{\\\\n		case 'textarea':\\\\n			return true;\\\\n		case 'input':\\\\n			switch (element.type)\\\\n			{\\\\n				case 'hidden':\\\\n				case 'text':\\\\n				case 'color':\\\\n				case 'date':\\\\n				case 'datetime':\\\\n				case 'datetime-local':\\\\n				case 'email':\\\\n				case 'month':\\\\n				case 'number':\\\\n				case 'range':\\\\n				case 'tel':\\\\n				case 'time':\\\\n				case 'url':\\\\n				case 'week':\\\\n					return true;\\\\n			}\\\\n	}\\\\n\\\\n	return false;\\\\n}\\\\n\\\\nfunction handle_form_saving_explicit(event,form)\\\\n{\\\\n	if (event.keyCode==83/*s*/ && (navigator.platform.match('Mac')?event.metaKey:event.ctrlKey) && (!navigator.platform.match('Mac')?event.ctrlKey:event.metaKey) && (!event.altKey))\\\\n	{\\\\n		\\\",\\n	((ecv_DEV_MODE(\\\$cl,array(),array())==\\\"1\\\")?(\\\"\\\\n			if (typeof console.log!='undefined') console.log('Doing explicit auto-save');\\\\n		\\\"):''),\\n	\\\"\\\\n\\\\n		event.preventDefault(); // Prevent browser save dialog\\\\n\\\\n		// Go through al fields to save\\\\n		var post='',found_validated_field=false,temp;\\\\n		for (var i=0;i<form.elements.length;i++)\\\\n		{\\\\n			if (form.elements[i].name=='validated') found_validated_field=true;\\\\n\\\\n			if (field_supports_autosave(form.elements[i]))\\\\n			{\\\\n				temp=_handle_form_saving(event,form.elements[i],true);\\\\n				if (temp)\\\\n				{\\\\n					if (post!='') post+='&';\\\\n					post+=window.encodeURIComponent(temp[0])+'='+window.encodeURIComponent(temp[1]);\\\\n				}\\\\n			}\\\\n		}\\\\n\\\\n		if (post!='')\\\\n		{\\\\n			document.body.style.cursor='wait';\\\\n\\\\n			// Save remotely\\\\n			if (navigator.onLine)\\\\n			{\\\\n				post=modsecurity_workaround_ajax(post);\\\\n				do_ajax_request('\\\",\\n	ecv_FIND_SCRIPT_NOHTTP(\\\$cl,array(2),array(\\\"autosave\\\")),\\n	\\\"?type=store'+keep_stub(),function() {\\\\n					if (document.body.style.cursor=='wait') document.body.style.cursor='';\\\\n\\\\n					var message=found_validated_field?'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:DRAFT_SAVED_WITH_VALIDATION\\\",array()),\\n	\\\"':'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:DRAFT_SAVED_WITHOUT_VALIDATION\\\",array()),\\n	\\\"';\\\\n					fauxmodal_alert(message,null,'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"javascript:DRAFT_SAVE\\\",array()),\\n	\\\"');\\\\n				},post);\\\\n			}\\\\n		}\\\\n	}\\\\n}\\\\n\\\\nfunction handle_form_saving(event,element,force)\\\\n{\\\\n	var temp=_handle_form_saving(event,element,force);\\\\n	if (temp)\\\\n	{\\\\n		var post=window.encodeURIComponent(temp[0])+'='+window.encodeURIComponent(temp[1]);\\\\n\\\\n		// Save remotely\\\\n		if (navigator.onLine)\\\\n		{\\\\n			\\\",\\n	((ecv_DEV_MODE(\\\$cl,array(),array())==\\\"1\\\")?(\\\"\\\\n				if (typeof console.log!='undefined') console.log('Doing AJAX auto-save');\\\\n			\\\"):''),\\n	\\\"\\\\n\\\\n			post=modsecurity_workaround_ajax(post);\\\\n			do_ajax_request('\\\",\\n	ecv_FIND_SCRIPT_NOHTTP(\\\$cl,array(2),array(\\\"autosave\\\")),\\n	\\\"?type=store'+keep_stub(),function() { },post);\\\\n		}\\\\n	}\\\\n}\\\\n\\\\nfunction _handle_form_saving(event,element,force)\\\\n{\\\\n	if (typeof force=='undefined') force=(event.type=='blur');\\\\n\\\\n	var this_date=new Date();\\\\n	if (!force)\\\\n	{\\\\n		if ((this_date.getTime()-window.last_autosave.getTime())<20*1000) return null; // Only save every 20 seconds\\\\n	}\\\\n\\\\n	if (typeof event=='undefined') event=window.event;\\\\n\\\\n	if (typeof element=='undefined')\\\\n	{\\\\n		element=(typeof event.target!='undefined')?event.target:event.srcElement;\\\\n	}\\\\n	if ((typeof element=='undefined') || (element===null))\\\\n	{\\\\n		return null; // Some weird error, perhaps an extension fired this event\\\\n	}\\\\n\\\\n	var value=clever_find_value(element.form,element);\\\\n	if ((event.type=='keypress') && (is_typed_input(element)))\\\\n	{\\\\n		value+=String.fromCharCode(event.keyCode?event.keyCode:event.charCode);\\\\n	}\\\\n\\\\n	// Mark it as saved, so the server can clear it out when we submit, signally local storage should get deleted too\\\\n	var element_name=(typeof element.name=='undefined')?element[0].name:element.name;\\\\n	var autosave_name=get_autosave_name(element_name);\\\\n	set_cookie(encodeURIComponent(get_autosave_url_stem()),'1',0.167/*4 hours*/);\\\\n\\\\n	window.last_autosave=this_date;\\\\n\\\\n	// Save locally\\\\n	if (typeof window.localStorage!='undefined')\\\\n	{\\\\n		\\\",\\n	((ecv_DEV_MODE(\\\$cl,array(),array())==\\\"1\\\")?(\\\"\\\\n			if (typeof console.log!='undefined') console.log('Doing local storage auto-save for '+element_name+' ('+autosave_name+')');\\\\n		\\\"):''),\\n	\\\"\\\\n\\\\n		try\\\\n		{\\\\n			localStorage.setItem(autosave_name,value);\\\\n		}\\\\n		catch (e) {}; // Could have NS_ERROR_DOM_QUOTA_REACHED\\\\n	}\\\\n\\\\n	return [autosave_name,value];\\\\n}\\\\n\\\\nfunction clever_set_value(form,element,value)\\\\n{\\\\n	if ((typeof element.length!='undefined') && (typeof element.nodeName=='undefined'))\\\\n	{\\\\n		// Radio button\\\\n		element=element[0];\\\\n	}\\\\n\\\\n	switch (element.nodeName.toLowerCase())\\\\n	{\\\\n		case 'textarea':\\\\n			set_textbox(element,value,value);\\\\n			break;\\\\n		case 'select':\\\\n			for (var i=0;i<element.options.length;i++)\\\\n			{\\\\n				if (element.options[i].value==value)\\\\n				{\\\\n					element.selectedIndex=i;\\\\n					if (typeof \\\\\\\$(element).select2!='undefined') {\\\\n						\\\\\\\$(element).trigger('change');\\\\n					}\\\\n				}\\\\n			}\\\\n			break;\\\\n		case 'input':\\\\n			switch (element.type)\\\\n			{\\\\n				case 'checkbox':\\\\n					element.checked=(value!='');\\\\n					break;\\\\n\\\\n				case 'radio':\\\\n					value='';\\\\n					for (var i=0;i<form.elements.length;i++)\\\\n					{\\\\n						if ((form.elements[i].name==element.name) && (form.elements[i].value==value))\\\\n							form.elements[i].checked=true;\\\\n					}\\\\n					break;\\\\n\\\\n				case 'text':\\\\n				case 'color':\\\\n				case 'date':\\\\n				case 'datetime':\\\\n				case 'datetime-local':\\\\n				case 'email':\\\\n				case 'month':\\\\n				case 'number':\\\\n				case 'range':\\\\n				case 'search':\\\\n				case 'tel':\\\\n				case 'time':\\\\n				case 'url':\\\\n				case 'week':\\\\n					element.value=value;\\\\n					break;\\\\n			}\\\\n	}\\\\n\\\\n	if (element.onchange) element.onchange();\\\\n}\\\\n\\\\nfunction get_autosave_url_stem()\\\\n{\\\\n	var name='cms_autosave_'+window.location.pathname;\\\\n	if (window.location.search.indexOf('type=')!=-1)\\\\n	{\\\\n		name+=window.location.search.replace(/[\\\\\\\\?&]redirect=.*/,'').replace(/[\\\\\\\\?&]keep_\\\\\\\\w+=.*/,'').replace(/[\\\\\\\\?&]cat=.*/,'');\\\\n	}\\\\n	name=name.replace(/\\\\\\\\./,'_'); // PHP can't use dots in field names\\\\n	return name;\\\\n}\\\\n\\\\nfunction get_autosave_name(field_name)\\\\n{\\\\n	return get_autosave_url_stem()+':'+field_name;\\\\n}\\\\n\\\";\");\";}}");

